---
layout: single
title: "[Digital Forenisc] - Prefetch 분석"
excerpt: "프리패치 파일 분석"
categories:
  - Forensic
date: 2024-09-22
last_modified_at: 2024-09-22
---

# 프리패치란?

- 부팅, 응용프로그램 실행에 필요한 시스템 자원들을 파일에 미리 저장해 더 빨리 시작할 수 있도록 설계된 메모리 관리 정책
- 필요한 파일과 데이터를 미리 메모리에 로드하여 실행속도를 높일 수 있다.
- 부트 프리패치와 응용프로그램 프리패치로 나뉨
- 프리패치 경로: %SystemRoot%\Prefetch 

응용프로그램을 시작하면 윈도우는 프리패치 파일을 참조하여 필요한 파일 및 데이터 중 일부를 메모리에 미리 로드하기 때문에 더 빨리 사용할 수 있다.

레지스트리에서 프리패치 사용 여부를 확인할 수 있다.<br>
HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management\PrefetchParameters

EnablePrefetcher 값:
 - 0: 비활성화
 - 1: 애플리케이션 프리패치 활성화
 - 2: 부트 프리패치 활성화 
 - 3: 모든 프리패치 활성화

<br>

# 부트 프리패치 

책에서 윈도우 10은 Fast Startup이 사용되면서 부트 프리패치가 없다고 하는데 더 알아봐야할 거 같다. 

# 애플리케이션 프리패치 

- 사용자가 자주 실행하는 응용 프로그램의 로딩 속도를 높이고 성능을 향상시키기 위한 기능 
- 프로그램 실행 과정에서 필요한 파일들과 데이터를 학습하고 분석

프리패치 경로에 \[실행파일명\]\-\[파일위치에 대한 해시\].pf 형식의 파일명 생성 <br>
*파일의 경로가 달라지면 해시 값이 달라짐

응용 프로그램 처음 실행 시 10초동안 모니터링 후 분석정보로 프리패치 파일 생성<br>
*10초 미만 실행 시 프리패치가 생성되지 않는다. 

프리패치의 최대 파일 개수<br>
- 윈도우 8 & 10: 1024개
- 윈도우 7: 128개

*최대치가 넘어가면 가장 오래된 프리패치 파일을 삭제하여 스토리지 공간을 확보

# 프리패치 파일 분석

프리패치 파일 분석하기 전에 압축 여부를 확인해야 한다. 윈도우 10부터는 무조건 압축되어 있기 때문에 압축된 프리패치 파일의 시그니처를 보면 MAM으로 되어 있다. 압축 해제된 프리패치 파일을 확인하기 위해서는 시그니처가 SCCA 인지 확인하면 된다. 

*Xpress Huffman Algorithm으로 압축?

윈도우 버전 별로 압축 해제된 원본 프리패치 파일 시작 시그니처가 다르다. 

|Value|Windows    |
| --- | ----------|
|0x17 | XP, 2003  |
|0X23 | Vista, 7  |
|0x1A | 8.1       |
|0x1E | 10        |

## 프리패치 파일 구조

# 프리패치 파일 분석 도구 

NirSoft - WinPrefetchView<br>
Eric Zimmerman's - PECmd (CMD 기반)

# 디지털 포렌식 관점
